---
alwaysApply: true
---

# 安全性最佳實踐

## 環境變數與機密管理
- **絕對不要**將機密資訊硬編碼在程式碼中
- 使用環境變數儲存：
  - `SECRET_KEY` - Flask 應用程式密鑰
  - `DATABASE_URL` - 資料庫連線字串
  - API 金鑰、OAuth 憑證等
- 更新 `.env.example` 作為環境變數範本（不含實際值）
- `.env` 檔案應列在 `.gitignore` 中

## 身份驗證與授權
- 使用 JWT (JSON Web Token) 進行身份驗證
- Token 應設定適當的過期時間
- 敏感操作需要重新驗證
- 實作角色基礎存取控制（RBAC）
- 密碼必須使用安全的雜湊演算法（如 bcrypt、argon2）

## 資料保護
- **密碼儲存**：絕不以明文儲存，使用 werkzeug.security 或 bcrypt
- **敏感資料**：如個人資料、聯絡方式應加密或遮罩
- **日誌記錄**：不要記錄密碼、Token 或敏感個人資料
- **錯誤訊息**：不要洩漏系統內部資訊或資料庫結構

## 輸入驗證與清理
- **後端驗證**：所有使用者輸入都必須驗證（不能只依賴前端驗證）
- **SQL 注入防護**：使用 ORM（SQLAlchemy）的參數化查詢
- **XSS 防護**：前端顯示使用者輸入時適當轉義
- **檔案上傳**：
  - 驗證檔案類型與大小
  - 使用隨機檔名儲存
  - 限制上傳目錄權限

## CORS 設定
- 正式環境限制允許的來源網域
- 不要使用 `Access-Control-Allow-Origin: *`
- 適當設定允許的 HTTP 方法與標頭

## 測試資料處理
- 測試帳號密碼記載於 [README.md](mdc:README.md) 而非程式碼中
- 範例 CSV 檔案不應包含真實個人資料
- 截圖分享時移除敏感資訊（姓名、電郵、電話等）
- 開發資料庫不應包含正式環境資料

## 依賴管理
- 定期更新套件版本以修補安全漏洞
- 檢查新增依賴的授權條款
- 使用 `npm audit` 或 `pip-audit` 檢查已知漏洞
- 鎖定依賴版本（使用 `pnpm-lock.yaml` 和 `requirements.txt`）

## API 安全
- 實作速率限制（Rate Limiting）防止濫用
- 使用 HTTPS（正式環境必須）
- 驗證 Content-Type 標頭
- 實作適當的逾時設定
- 記錄異常的 API 呼叫模式

## 資料庫安全
- 使用最小權限原則
- 定期備份資料庫
- 敏感欄位加密儲存
- 實作軟刪除而非直接刪除重要資料
- 稽核重要操作（如權限變更、大量刪除）
